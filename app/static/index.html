<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AnimeSonarrProxy - Mapping Manager</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>ðŸŽŒ AnimeSonarrProxy</h1>
            <p>Anime Title Mapping Manager</p>
        </header>

        <div class="stats">
            <div class="stat-card">
                <h3 id="total-mappings">0</h3>
                <p>TV Mappings</p>
            </div>
            <div class="stat-card">
                <h3 id="total-overrides">0</h3>
                <p>TV Overrides</p>
            </div>
            <div class="stat-card">
                <h3 id="total-movie-mappings">0</h3>
                <p>Movie Mappings</p>
            </div>
            <div class="stat-card">
                <h3 id="total-movie-overrides">0</h3>
                <p>Movie Overrides</p>
            </div>
            <div class="stat-card">
                <h3 id="last-update">-</h3>
                <p>DB Last Updated</p>
            </div>
        </div>

        <!-- Tab Navigation -->
        <div class="tab-navigation">
            <button class="tab-btn active" data-tab="tv" onclick="switchTab('tv')">TV Series (Sonarr)</button>
            <button class="tab-btn" data-tab="movies" onclick="switchTab('movies')">Movies (Radarr)</button>
        </div>

        <!-- TV Tab Content -->
        <div class="tab-content active" id="tv-tab">
        <div class="section">
            <h2>Add New TV Override</h2>
            <form id="override-form">
                <div class="form-group">
                    <label for="tvdb-id">TVDB ID *</label>
                    <input type="number" id="tvdb-id" required placeholder="e.g., 79604">
                </div>

                <div class="form-group">
                    <label for="anilist-id">AniList ID (optional)</label>
                    <input type="number" id="anilist-id" placeholder="e.g., 154587">
                    <small>Find on AniList.co in URL: anilist.co/anime/<strong>ID</strong></small>
                </div>

                <div class="form-group">
                    <label for="mal-id">MyAnimeList ID (optional)</label>
                    <input type="number" id="mal-id" placeholder="e.g., 52991">
                </div>

                <div class="form-group">
                    <label for="custom-titles">Custom Search Titles (one per line)</label>
                    <textarea id="custom-titles" rows="4" placeholder="Sousou no Frieren
Frieren: Beyond Journey's End
Frieren
è‘¬é€ã®ãƒ•ãƒªãƒ¼ãƒ¬ãƒ³"></textarea>
                </div>

                <div class="form-group">
                    <label for="notes">Notes (optional)</label>
                    <textarea id="notes" rows="2" placeholder="Additional notes about this mapping..."></textarea>
                </div>

                <!-- Episode Mapping Section -->
                <div class="episode-section">
                    <h3>Episode Mappings</h3>
                    <p class="section-description">Map TVDB season/episode numbers to absolute episode numbers when TheXEM doesn't have the data.</p>

                    <!-- Add Season Range Form -->
                    <div class="season-range-form">
                        <div class="form-row">
                            <div class="form-field">
                                <label for="season-num">Season</label>
                                <input type="number" id="season-num" min="0" value="1" placeholder="1">
                            </div>
                            <div class="form-field">
                                <label for="episode-count">Episodes</label>
                                <input type="number" id="episode-count" min="1" value="12" placeholder="12">
                            </div>
                            <div class="form-field">
                                <label for="start-absolute">Start Absolute</label>
                                <input type="number" id="start-absolute" min="1" value="1" placeholder="1">
                            </div>
                            <div class="form-field form-field-button">
                                <button type="button" class="btn-secondary" onclick="addSeasonRange()">+ Add Season</button>
                            </div>
                        </div>
                    </div>

                    <!-- Episode Mappings Table -->
                    <div class="episode-table-container">
                        <table class="episode-table" id="episode-table">
                            <thead>
                                <tr>
                                    <th>Season</th>
                                    <th>Episode</th>
                                    <th>Absolute</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="episode-table-body">
                                <!-- Dynamically populated -->
                            </tbody>
                            <tfoot>
                                <tr class="add-episode-row">
                                    <td><input type="number" id="add-season" min="0" value="1" placeholder="S"></td>
                                    <td><input type="number" id="add-episode" min="1" value="1" placeholder="E"></td>
                                    <td><input type="number" id="add-absolute" min="1" value="1" placeholder="Abs"></td>
                                    <td><button type="button" class="btn-small add" onclick="addSingleEpisode()">+</button></td>
                                </tr>
                            </tfoot>
                        </table>
                        <p class="episode-count-info">
                            <span id="episode-mapping-count">0</span> episode mapping(s)
                        </p>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn-primary" id="submit-btn">Save Override</button>
                    <button type="button" class="btn-secondary" id="cancel-btn" onclick="cancelEdit()" style="display: none;">Cancel Edit</button>
                </div>
            </form>
        </div>

        <div class="section">
            <h2>Cached TV Mappings</h2>
            <div class="table-controls">
                <input type="text" id="search-mappings" placeholder="Search by TVDB ID or title...">
                <button onclick="loadMappings()" class="btn-secondary">Refresh</button>
            </div>
            <div id="mappings-list" class="mappings-table">
                <p>Loading mappings...</p>
            </div>
        </div>
        </div><!-- End TV Tab -->

        <!-- Movies Tab Content -->
        <div class="tab-content" id="movies-tab">
        <div class="section">
            <h2>Add New Movie Override</h2>
            <form id="movie-override-form">
                <div class="form-group">
                    <label for="tmdb-id">TMDB ID *</label>
                    <input type="number" id="tmdb-id" required placeholder="e.g., 916224">
                    <small>Find on TMDB.org in URL: themoviedb.org/movie/<strong>ID</strong></small>
                </div>

                <div class="form-group">
                    <label for="movie-imdb-id">IMDb ID (optional)</label>
                    <input type="text" id="movie-imdb-id" placeholder="e.g., tt16428256">
                </div>

                <div class="form-group">
                    <label for="movie-anilist-id">AniList ID (optional)</label>
                    <input type="number" id="movie-anilist-id" placeholder="e.g., 142838">
                    <small>Find on AniList.co in URL: anilist.co/anime/<strong>ID</strong></small>
                </div>

                <div class="form-group">
                    <label for="movie-mal-id">MyAnimeList ID (optional)</label>
                    <input type="number" id="movie-mal-id" placeholder="e.g., 50594">
                </div>

                <div class="form-group">
                    <label for="movie-year">Release Year (optional)</label>
                    <input type="number" id="movie-year" placeholder="e.g., 2022">
                </div>

                <div class="form-group">
                    <label for="movie-custom-titles">Custom Search Titles (one per line)</label>
                    <textarea id="movie-custom-titles" rows="4" placeholder="Suzume no Tojimari
Suzume
ã™ãšã‚ã®æˆ¸ç· ã¾ã‚Š"></textarea>
                </div>

                <div class="form-group">
                    <label for="movie-notes">Notes (optional)</label>
                    <textarea id="movie-notes" rows="2" placeholder="Additional notes about this mapping..."></textarea>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn-primary" id="movie-submit-btn">Save Movie Override</button>
                    <button type="button" class="btn-secondary" id="movie-cancel-btn" onclick="cancelMovieEdit()" style="display: none;">Cancel Edit</button>
                </div>
            </form>
        </div>

        <div class="section">
            <h2>Cached Movie Mappings</h2>
            <div class="table-controls">
                <input type="text" id="search-movie-mappings" placeholder="Search by TMDB ID or title...">
                <button onclick="loadMovieMappings()" class="btn-secondary">Refresh</button>
            </div>
            <div id="movie-mappings-list" class="mappings-table">
                <p>Loading movie mappings...</p>
            </div>
        </div>
        </div><!-- End Movies Tab -->
    </div>

    <div id="notification" class="notification hidden"></div>

    <script src="/static/script.js"></script>
</body>
</html>
